# Руководство пользователя SVS

## Установка и запуск
- Установите Python 3.12 или новее и убедитесь, что инструмент [uv](https://github.com/astral-sh/uv) доступен в системе.
- Убедитесь, что FFmpeg установлен и доступен из `PATH` (см. раздел «Установка FFmpeg» ниже).
- В корне проекта выполните команду синхронизации зависимостей:
  ```bash
  uv sync
  ```
- Запустите приложение командой:
  ```bash
  uv run video-slicer
  ```

## Импорт видео и создание сегментов вручную
1. В блоке «Входной видеофайл» нажмите кнопку «Обзор…» и выберите исходный ролик.
2. Укажите «Выходную папку», куда будут сохраняться результаты обработки.
3. Добавьте сегмент кнопкой «Добавить сегмент» и задайте время начала и конца. Время можно вводить в форматах `HH:MM:SS`, `MM:SS` или в секундах.
4. Настройте параметры обработки: оставьте режим `copy` для быстрой нарезки без перекодирования или выберите кодеки и CRF для конвертации. При необходимости отметьте флажок «Удалить аудиодорожку», чтобы сохранить только видеопоток.
5. Нажмите «Запустить обработку», чтобы сформировать файлы сегментов.

## Создание сегментов по текстовому описанию
- Нажмите кнопку «Создать список» над таблицей сегментов, чтобы открыть диалог массового создания.
- В текстовое поле вставьте описание вида:
  ```
  00:00 Вступление
  02:15 Основная часть
  05:30 Финал
  ```
- Каждая строка должна начинаться с отметки времени (в том же формате, что и при ручном вводе), после которой можно указать название блока.
- Диалог поддерживает автоматическую проверку порядка времени и сообщит о несовпадениях.
- Используйте опцию «Добавлять нумерацию», чтобы перед названием сегмента автоматически подставлялась порядковая цифра.
- Флажок «Сохранять описание в имени файла» добавляет текстовые подписи в итоговые названия файлов; разделитель между номером и описанием можно изменить в поле «Разделитель».
- После подтверждения приложение построит сегменты на основе списка и предложит объединить их с текущими данными.

## Интерфейс создания списков из текстового описания
- Поле ввода поддерживает многострочный текст и подсказку по формату.
- Поддерживаются разделители `-`, `—` и `–` между временем и описанием. Если описание не указано, файлы будут названы автоматически.
- Опция «Сохранять описание в имени файла» сохраняет текст в имени сегмента; если опция отключена, описания попадут только в таблицу.
- Если включены обе опции («Нумерация» и «Описание»), можно задать пользовательский разделитель (по умолчанию `_`). Запрещены символы `<>:"/\|?*`.
- Перед созданием сегментов диалог отобразит итоговый список и запросит подтверждение, показывая количество новых элементов.

## Предпросмотр сегментов
- В таблице сегментов для каждой строки доступна кнопка «Предпросмотр» (иконка ▶).
- Диалог предпросмотра генерирует миниатюру с помощью FFmpeg и показывает точное время начала в формате `HH:MM:SS`.
- Просмотр помогает убедиться, что границы сегмента выставлены корректно до запуска обработки.

## Отображение метаинформации
- Столбец «Метаинфо» показывает состояние данных о результирующем файле сегмента.
- После завершения обработки можно открыть диалог метаданных, чтобы увидеть контейнер, кодеки и путь к сохраненному файлу.
- Кнопка «Метаинфо» над таблицей отображает подробную информацию о исходном видео: длительность, разрешение, используемые дорожки.

## Сохранение и загрузка списков сегментов
- Меню «Файл → Сохранить сегменты…» сохраняет текущий список в JSON (`segments.json`). Для каждого сегмента записываются поля `start_time`, `end_time`, `filename`, `format`, `convert`, `video_codec`, `audio_codec`, `crf` и `extra_params`.
- Меню «Файл → Загрузить сегменты…» позволяет восстановить список из сохраненного JSON. При чтении поддерживаются значения времени в форматах `HH:MM:SS`, `MM:SS` или в секундах.
- Полученный JSON можно дополнительно конвертировать в CSV с помощью внешних инструментов, если нужно поделиться списком вне приложения.

## Меню «Настройки»
- **Язык интерфейса** — переключение между русским и английским языками.
- **Тема оформления** — светлая или темная тема элементов управления.
- **Путь к FFmpeg** — ручной выбор бинарного файла `ffmpeg`; кнопка «Определить автоматически» ищет исполняемый файл в стандартных директориях.
- **Ведение журнала** — флажок «Сохранять полный журнал в файл» включает запись сообщений в указанную локацию.
- **Файл журнала** — выбор места хранения файла `.log`; значение по умолчанию берется из домашнего каталога пользователя.
- **Удалять метаданные сегментов** — удаляет встроенные теги из экспортированных файлов.
- **Встраивать метаданные SVS** — добавляет служебную информацию о генераторе сегментов.
- **Использовать кнопки-иконки** — заменяет текстовые кнопки в таблице сегментов на компактные иконки.

## Журнал обработки
- Панель «Журнал» в нижней части окна фиксирует все операции: запуск сегментов, сообщения FFmpeg и результат обработки.
- Метки времени добавляются автоматически, что удобно для последующего анализа.
- Кнопка «Копировать журнал» копирует текст в буфер обмена. При включенном файловом журналировании записи дублируются в выбранный `.log` файл.

## Перекодирование сегментов и всего файла
- Для быстрой нарезки оставьте параметры видео и аудио кодеков в положении `copy` — FFmpeg создаст сегменты без повторного кодирования.
- Чтобы перекодировать сегмент, установите флажок «Конвертировать» и выберите кодеки (например, `libx264` для видео и `aac` для аудио), при необходимости измените `CRF` и дополнительные параметры.
- Для перекодирования всего файла создайте один сегмент от `00:00:00` до конца ролика (оставьте поле «Конец» пустым). Параметры кодеков будут применены ко всему видео.

## Установка FFmpeg
### Linux (Debian/Ubuntu)
```bash
sudo apt update
sudo apt install ffmpeg
```

### Windows
1. Загрузите архив с [официального сайта FFmpeg](https://ffmpeg.org/download.html).
2. Распакуйте его и добавьте папку `bin` в переменную окружения `PATH`.

### macOS (Homebrew)
```bash
brew install ffmpeg
```

## Сохранение и загрузка профилей приложений
- Настройки интерфейса, языка, расположения файлов и логирования сохраняются автоматически при закрытии приложения.
- Файл конфигурации можно перенести на другой компьютер, чтобы сохранить среду работы.

## Дополнительные советы
- Используйте предпросмотр перед стартом, чтобы не тратить время на неправильные сегменты.
- Проверяйте журнал после завершения обработки: сообщения FFmpeg помогут диагностировать проблемы с кодеками.
- Регулярно экспортируйте списки сегментов, если работаете над крупными проектами, чтобы иметь резервную копию конфигурации.
