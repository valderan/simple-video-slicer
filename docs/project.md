# Техническое задание: Desktop-приложение для нарезки видеофайлов

## 1. Общее описание проекта

Название проекта: SVS - Simple Video Slicer
Тип приложения: Desktop GUI-приложение с графическим интерфейсом
Назначение: Нарезка больших видеофайлов на фрагменты согласно заданным пользователем временным интервалам с опциональной конвертацией выходных файлов.
Целевая аудитория: Пользователи, работающие с большими видеофайлами (записи с камер наблюдения, длительные записи экрана, обучающие материалы и т.д.), которым необходимо разделить видео на фрагменты без потери качества.

Ключевые требования:
Локальное выполнение на компьютере пользователя​
Кроссплатформенность (Linux, Windows, macOS)​
Быстрая обработка без перекодирования (lossless copy)​
Опциональная конвертация формата при необходимости​
Предпросмотр выбранных интервалов видео​
Поддержка больших видеофайлов (десятки GB)​
Всегда отвечай на русском языке
Документацию разрабатывай на русском языке, и создавай копию документации на английском **_EN.md
Интерфейс программы должен поддерживать два языка - русский и английский

## 2. Технический стек
### 2.1 Основные технологии
Язык программирования: Python 3.12+​
Пакетный менеджер: uv (для управления зависимостями и виртуальным окружением)​
GUI Framework: PySide6 (Qt for Python 6)​
Инструмент обработки видео: FFmpeg (через subprocess или ffmpeg-python)​
Целевая ОС разработки: Linux Mint 22.2 Zara (base: Ubuntu 24.04 noble)

### 2.2 Зависимости проекта
Создать pyproject.toml со следующими основными зависимостями(это для примера и необязательно):

```toml
[project]
name = "video-slicer"
version = "0.1.0"
description = "Desktop application for slicing video files"
requires-python = ">=3.12"
dependencies = [
    "PySide6>=6.6.0",
    "ffmpeg-python>=0.2.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.0",
    "black>=23.0",
    "ruff>=0.1.0",
]
```
Внешние зависимости:
FFmpeg (должен быть установлен в системе и доступен в PATH)

## 3. Архитектура приложения

### 3.1 Структура проекта
- Разделение на директории: ui, core, models, utils, tests

Для примера могу предложить такую структуру(но это необязательно):
```text
video-slicer/
├── pyproject.toml
├── uv.lock
├── README.md
├── .gitignore
├── src/
│   └── video_slicer/
│       ├── __init__.py
│       ├── main.py                  # Точка входа приложения
│       ├── ui/
│       │   ├── __init__.py
│       │   ├── main_window.py       # Главное окно (QMainWindow)
│       │   ├── main_window.ui       # Qt Designer файл (опционально)
│       │   ├── segment_dialog.py    # Диалог добавления/редактирования фрагмента
│       │   └── preview_dialog.py    # Диалог предпросмотра видео
│       ├── core/
│       │   ├── __init__.py
│       │   ├── video_processor.py   # Логика работы с FFmpeg
│       │   ├── segment_manager.py   # Управление списком сегментов
│       │   └── format_converter.py  # Конвертация форматов
│       ├── models/
│       │   ├── __init__.py
│       │   └── segment.py           # Модель данных фрагмента
│       └── utils/
│           ├── __init__.py
│           ├── ffmpeg_helper.py     # Вспомогательные функции FFmpeg
│           ├── time_parser.py       # Парсинг временных меток
│           └── validators.py        # Валидация входных данных
└── tests/
    ├── __init__.py
    ├── test_video_processor.py
    └── test_segment_manager.py

``` 

### 3.2 Паттерны проектирования
- MVC/MVP
- Worker Thread Pattern
- Signal-Slot Mechanism

## 4. Функциональные требования
### 4.1 Главное окно приложения (MainWindow)
### 4.1.1 Компоненты интерфейса
Главное окно должно содержать следующие элементы (сверху вниз):

1. Секция выбора файла:
Label: "Входной видеофайл:"
LineEdit (read-only): Отображение полного пути к выбранному файлу
QPushButton: "Обзор..." - открывает QFileDialog для выбора видеофайла​
Label (информация о файле): Отображение длительности, разрешения, кодека после выбора файла

2. Секция выбора выходной папки:
Label: "Выходная папка:"
LineEdit (read-only): Отображение пути к выходной папке
QPushButton: "Обзор..." - открывает QFileDialog для выбора папки​

3. Секция управления фрагментами:
QTableWidget со следующими колонками:​
№ - автоматическая нумерация (не редактируется)
Имя файла - название выходного файла (редактируется, опционально)
Начало - время начала в формате HH:MM:SS или HH:MM:SS.mmm (редактируется)
Конец - время конца в формате HH:MM:SS или HH:MM:SS.mmm (редактируется, опционально - может быть "до следующего")
Формат - выбор формата (MP4/AVI/MKV/WEBM/MOV/FLV - редактируется через QComboBox)​
Конвертация - чекбокс (вкл/выкл перекодирования)
Предпросмотр - кнопка для открытия диалога предпросмотра

Панель кнопок управления таблицей:
QPushButton: "Добавить фрагмент" - открывает диалог добавления​
QPushButton: "Редактировать" - открывает диалог редактирования выбранного фрагмента​
QPushButton: "Удалить" - удаляет выбранный фрагмент
QPushButton: "Очистить всё" - очищает весь список
QPushButton: "Импорт списка" - загрузка сегментов из CSV/JSON файла (опционально)
QPushButton: "Экспорт списка" - сохранение сегментов в CSV/JSON (опционально)

4. Секция выполнения:
QProgressBar: Общий прогресс выполнения задачи (в процентах от всех фрагментов)​
QLabel: Текущий этап (например: "Обработка фрагмента 3 из 10: fragment_03.mp4")
QTextEdit (read-only, multi-line): Мини-консоль (логи выполнения, максимум 500 строк с auto-scroll)​
Вывод типа: "Начало обработки fragment_01.mp4...", "FFmpeg: Копирование потока...", "Завершено: fragment_01.mp4"

Панель кнопок:
QPushButton: "Начать обработку" - запускает процесс нарезки
QPushButton: "Остановить" - прерывает текущую обработку (через terminate FFmpeg процесса)

5. Строка состояния (QStatusBar):
Отображение текущего состояния приложения ("Готово к работе", "Обработка...", "Ошибка: ...")​

### 4.2 Диалог добавления/редактирования фрагмента (SegmentDialog)
Класс: QDialog

Компоненты:
QLabel + QLineEdit: "Имя файла" (если пусто, генерируется автоматически как fragment_001, fragment_002 и т.д.)
QLabel + QTimeEdit или QLineEdit: "Время начала (HH:MM:SS.mmm)" с валидацией​
QLabel + QTimeEdit или QLineEdit: "Время конца (HH:MM:SS.mmm)" (опционально - может быть пустым, означает "до следующего фрагмента или до конца видео")
QLabel + QComboBox: "Формат выходного файла" (MP4, AVI, MKV, WEBM, MOV, FLV)
QCheckBox: "Конвертировать видео" (если выключено - используется -c copy для lossless копирования)​

QGroupBox (если конвертация включена):
QLabel + QComboBox: "Видео кодек" (h264, h265/hevc, vp9, av1, copy)
QLabel + QComboBox: "Аудио кодек" (aac, mp3, opus, vorbis, copy)
QLabel + QSpinBox: "Качество видео (CRF 0-51)" (по умолчанию 23)​
QLabel + QLineEdit: "Дополнительные параметры FFmpeg" (опционально)
Кнопки: OK, Cancel (QDialogButtonBox)

### 4.3 Диалог предпросмотра (PreviewDialog)
Класс: QDialog

Компоненты:
QLabel или QWidget (видео-контейнер): Отображение превью-изображения выбранного фрагмента​
Генерация thumbnail через FFmpeg: -ss <start_time> -i input.mp4 -frames:v 1 preview.jpg​
Опционально: несколько кадров (например, 4-6 кадров) из интервала​
QLabel: Информация о фрагменте (длительность, размер, кодек)
Кнопка: "Закрыть"

## 5 Поддерживаемые форматы видео
Входные форматы:
MP4 (.mp4)
AVI (.avi)
MKV (.mkv)
WEBM (.webm)
MOV (.mov)
FLV (.flv)
WMV (.wmv)
MPEG (.mpg, .mpeg)
M4V (.m4v)
3GP (.3gp)

Выходные форматы:
MP4 (рекомендуется, универсальный)​
MKV (для сохранения всех дорожек и метаданных)​
AVI (старый формат, большие файлы)​
WEBM (для веб, хорошее сжатие)​
MOV (для macOS/QuickTime)​

## 6. Нефункциональные требования
### 6.1 Производительность
Lossless копирование: обработка 1 часа видео < 1 минуты​
С перекодированием: зависит от мощности CPU, показывать реальное время обработки
Поддержка больших файлов: тестировать на файлах 10+ GB​
Многопоточность: использовать QThreadPool для параллельной обработки нескольких фрагментов (опционально)​

### 6.2 Кроссплатформенность

ffmpeg можно скачать и положить в рабочую директорию проекта 

Linux:
Установка FFmpeg: sudo apt install ffmpeg 
Использовать нативные пути: /home/user/Videos/

Windows:
FFmpeg должен быть в PATH или в папке приложения
Использовать пути с обратными слешами или pathlib.Path

macOS:
Установка FFmpeg: brew install ffmpeg
Использовать нативные диалоги выбора файлов​

### 6.3 Обработка ошибок
Обязательные проверки:
FFmpeg установлен и доступен​
Входной видеофайл существует и читаем
Выходная папка существует и доступна для записи
Временные метки валидны и не выходят за пределы длительности видео
Достаточно места на диске
Формат файла поддерживается FFmpeg​

Типы ошибок для обработки:
Файл не найден
Недостаточно прав доступа
Недостаточно места на диске
Поврежденный видеофайл
Неподдерживаемый кодек
Ошибки FFmpeg (парсинг stderr)​

6.4 Логирование
Реализовать систему логирования
Логировать:
Запуск/остановка приложения
Выбор файлов и папок
Начало/завершение обработки каждого фрагмента
Команды FFmpeg
Ошибки с полным traceback
Предупреждения (warnings)

## 7. Дополнительные функции

### 7.1 Пакетная обработка нескольких файлов
Добавить вкладку "Пакетная обработка"
Список файлов с одинаковыми настройками нарезки

### 7.2 Шаблоны (Templates)
Сохранение настроек фрагментов как шаблон
Быстрое применение шаблона к новым файлам

### 7.3 Интеграция с видеоплеером
Встроенный плеер для точного выбора начала/конца​
Перемотка, пауза, выбор кадра

### 7.4 Автоопределение сцен
Использование FFmpeg scene detection для автоматической нарезки

### 7.5 Метаданные и главы
Добавление глав (chapters) в MP4/MKV​

Редактирование метаданных (название, автор, дата)

## 8. Документация для пользователя
### 8.1 README.md
Создать README с разделами:
Описание проекта
Установка FFmpeg для разных ОС
Установка приложения через uv
Быстрый старт (скриншоты)
FAQ
Известные проблемы
Лицензия

### 8.2 Встроенная справка
Добавить в меню "Help" → "Руководство пользователя"

Tooltips для всех элементов GUI

